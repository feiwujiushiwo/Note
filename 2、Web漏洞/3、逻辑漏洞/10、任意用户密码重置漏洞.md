# 任意用户密码重置漏洞

## 1、概述

### 1.1、定义

任意用户密码重置漏洞是指网站存在某些缺陷可导致攻击者重新设置该<font color = red>系统任意用户</font>的密码

> 严格意义上来说，任意用户密码重置并不算是一种漏洞类型，而是<font color="gree">利用其他漏洞</font>实现的同一种攻击方法。由于用户密码是十分重要的敏感信息，通过重置用户密码就可以直接登入该用户账号，获取用户数据甚至执行一些十分敏感的操作，所以该漏洞危害程度很高，在逻辑漏洞中单独列出来讨论。
>
> 有时通过UPDATE类型的SQL注入也可以完成任意用户密码重置，我们在此不做详细展开。这里重点关注网站开启“找回密码”、“重置密码”功能的业务逻辑，探讨该功能设计是否合理。相同地，对大家研究网站其他功能的设计安全性也能够有所启发。

### 1.2、典型场景

| 漏洞场景                                                     | 漏洞类型       |
| ------------------------------------------------------------ | -------------- |
| 找回密码要素（密码、手机号、邮箱、身份证号）可被越权修改     | 越权漏洞       |
| 找回密码的验证码/验证链接中的Key可被暴力破解                 | 暴力破解漏洞   |
| 找回密码链接中的要素可被预测或遍历（例如：md5(用户名)、日期+用户名+四位数字、用户id） | 预测/遍历漏洞  |
| 找回密码链接中包含用户名或编码后的用户名信息                 | 信息泄露漏洞   |
| 将其他用户的找回链接/短信发送至自己的邮箱/手机               | 非授权访问漏洞 |
| Session中保存的用户名与验证成功信息分属于两个不同的Cookie，可通过在中间过程替换Cookie实现重置其他用户密码 | 中间人攻击漏洞 |
| 重置后直接进入登录状态时可越权登录其他用户                   | 越权漏洞       |
| 覆盖注册，绕过用户名相同校验后注册并覆盖该用户               | 漏洞利用       |
| 通过验证后，可越权修改其他账号密码                           | 越权漏洞       |
| Session绑定关系混乱导致一个Session同时拥有两个用户密码的修改权限 | 权限混淆漏洞   |

## 2、漏洞防御

- 根据每个场景所对应的漏洞寻找防御方式。
