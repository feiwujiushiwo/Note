# 越权漏洞

## 1、概述

**越权漏洞**是指攻击者跨越网站应用原本的权限管理设计而读取或操作其他用户或管理员的数据和设置的一类漏洞。

**危险等级：** 低~严重

> 一般情况下，越权漏洞可分为**水平越权**和**垂直越权**。

## 2、漏洞原理

网站设计时，为了标识用户，往往会给不同的用户分配不同的Session来维持用户会话。以读取个人信息为例，当用户提交读取个人信息请求时，网站应当判断当前用户是否拥有读取的权限，而此时的判断依据应当源自于用户本身的Session，而不应当以用户提交的id作为参考，不应当在没有校验的情况下返回用户提交id所对应的用户信息。
一般情况下，低级越权漏洞产生的原因是由于大多数网站设计者认为前端校验可以避免越权，认为前端固定用户id即可信任用户所提交的参数，或是在功能设计时将id进行简单的base64编码来认定用户身份。

1. **不正确的授权验证：** 某些系统在访问控制方面存在漏洞，未对用户进行充分的身份验证或权限验证。攻击者可以利用这些缺陷，伪装成已经授权的用户或者直接访问受限资源。
2. **会话管理问题：** 若系统在会话管理上存在漏洞，攻击者可能通过修改会话信息或利用会话固定等方式来提升自己的权限，获取更高级别的权限。
3. **缺乏足够的访问控制：** 系统在访问控制上缺乏细致的控制，例如对于敏感数据或操作的访问未进行充分的限制或验证，攻击者通过越权漏洞可以获取到这些资源或执行敏感操作。
4. **未经检查的直接对象引用：** 有些系统在处理用户请求时，未对用户对资源的合法性进行验证，攻击者可以通过直接操作资源标识符或引用来访问受限资源。
5. **安全配置错误：** 错误的安全配置可能导致系统暴露敏感信息或未经授权的功能，攻击者可以利用这些错误配置来执行越权攻击。

**越权漏洞的逻辑错误主要有两点：**

1. 网站设计者面向的是大多数普通用户，但网站安全的设计者**应当面向所有情况**。以为“普通用户”不会看到hidden隐藏的值，自然也不会修改”的观点本身就是错误的。
2. **在任何情况下都不应当偷懒**。“用户是否能找的到该接口”和“是否校验”在本质上是有区别的。因为忽视了搜索引擎爬取的力量，忽视了暴力破解的力量，忽视了逻辑推理的力量。

## 3、常见的越权漏洞

- 修改表单中的id 直接读取、修改他人信息。
- 通过 view_controller 推理出 edit_controller 从而获取管理员编辑权限。
- 通过 xiaoming201901011234 猜测到他人的数据可能是 用户名+年月日+4位随机数，再进行暴力破解
- 通过阅读应用源码、HTML、JS等获取到隐藏的缺乏校验的接口。
- 在Cookie中修改 edit=false 为 edit= true 以获取某项权限。
- 用户注销后形成幽灵用户，再注册相同用户名的用户就拥有原来用户的权限
- 构造数组以绕过对第一个元素的校验。例如：user[0]=11332&user[1]=11333&user[2]=11334

## 4、漏洞防御

1. 对网站权限进行合理划分，除了明确被允许的功能外，其他功能都应设置验证，若验证失败则禁止访问。
2. 权限最小化原则，限制用户不必要的权限，用户权限过期后应当予以回收。
3. 在服务器端进行验证，对于用户身份的识别应当基于Session而不是简单地使用用户提交的参数。
